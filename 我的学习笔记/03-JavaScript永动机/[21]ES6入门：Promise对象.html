<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[21] ES6 入门：Promise 对象 | 叶旭瑶</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.2e040761.css" as="style"><link rel="preload" href="/assets/js/app.a8df1c95.js" as="script"><link rel="preload" href="/assets/js/2.48d09664.js" as="script"><link rel="preload" href="/assets/js/31.32df4c34.js" as="script"><link rel="prefetch" href="/assets/js/10.90ae3223.js"><link rel="prefetch" href="/assets/js/11.60747cf8.js"><link rel="prefetch" href="/assets/js/12.78613ebb.js"><link rel="prefetch" href="/assets/js/13.15cefad8.js"><link rel="prefetch" href="/assets/js/14.2706d9af.js"><link rel="prefetch" href="/assets/js/15.4a1534b3.js"><link rel="prefetch" href="/assets/js/16.667b9eec.js"><link rel="prefetch" href="/assets/js/17.2f6f2fb7.js"><link rel="prefetch" href="/assets/js/18.ae0db680.js"><link rel="prefetch" href="/assets/js/19.3a1a9b2b.js"><link rel="prefetch" href="/assets/js/20.b37fd568.js"><link rel="prefetch" href="/assets/js/21.00e571a2.js"><link rel="prefetch" href="/assets/js/22.7113929a.js"><link rel="prefetch" href="/assets/js/23.76749a7b.js"><link rel="prefetch" href="/assets/js/24.d64a7195.js"><link rel="prefetch" href="/assets/js/25.dd0efafa.js"><link rel="prefetch" href="/assets/js/26.b526a833.js"><link rel="prefetch" href="/assets/js/27.0d7e1a2b.js"><link rel="prefetch" href="/assets/js/28.ff5daa9c.js"><link rel="prefetch" href="/assets/js/29.6b832bc1.js"><link rel="prefetch" href="/assets/js/3.dc0eeb90.js"><link rel="prefetch" href="/assets/js/30.9473db5d.js"><link rel="prefetch" href="/assets/js/32.e34273e7.js"><link rel="prefetch" href="/assets/js/33.4d28e2f8.js"><link rel="prefetch" href="/assets/js/34.e19c3a87.js"><link rel="prefetch" href="/assets/js/35.ae6f54a4.js"><link rel="prefetch" href="/assets/js/36.c311869c.js"><link rel="prefetch" href="/assets/js/37.fe07ec53.js"><link rel="prefetch" href="/assets/js/38.b9b76405.js"><link rel="prefetch" href="/assets/js/39.ce5b3eb6.js"><link rel="prefetch" href="/assets/js/4.52766d3a.js"><link rel="prefetch" href="/assets/js/40.c28128a5.js"><link rel="prefetch" href="/assets/js/41.baa5b9df.js"><link rel="prefetch" href="/assets/js/42.e9dd8626.js"><link rel="prefetch" href="/assets/js/43.1870fb99.js"><link rel="prefetch" href="/assets/js/44.5f5cadd9.js"><link rel="prefetch" href="/assets/js/45.6e86d635.js"><link rel="prefetch" href="/assets/js/46.6f9e3d5c.js"><link rel="prefetch" href="/assets/js/47.da89bc26.js"><link rel="prefetch" href="/assets/js/48.29abeeb3.js"><link rel="prefetch" href="/assets/js/49.82a3a29d.js"><link rel="prefetch" href="/assets/js/5.9eccb937.js"><link rel="prefetch" href="/assets/js/50.b2028d20.js"><link rel="prefetch" href="/assets/js/51.9208c15a.js"><link rel="prefetch" href="/assets/js/52.db1c8ad3.js"><link rel="prefetch" href="/assets/js/53.2c6c7978.js"><link rel="prefetch" href="/assets/js/54.4a5fc56a.js"><link rel="prefetch" href="/assets/js/55.43d12619.js"><link rel="prefetch" href="/assets/js/56.f78e78dd.js"><link rel="prefetch" href="/assets/js/57.b92e209e.js"><link rel="prefetch" href="/assets/js/58.6b552921.js"><link rel="prefetch" href="/assets/js/59.90266c96.js"><link rel="prefetch" href="/assets/js/6.710abc21.js"><link rel="prefetch" href="/assets/js/60.fb66ef65.js"><link rel="prefetch" href="/assets/js/61.82cc26c2.js"><link rel="prefetch" href="/assets/js/62.a0a80205.js"><link rel="prefetch" href="/assets/js/63.dda7942d.js"><link rel="prefetch" href="/assets/js/64.0a5e6f5b.js"><link rel="prefetch" href="/assets/js/65.fb8144ce.js"><link rel="prefetch" href="/assets/js/66.8a1226d0.js"><link rel="prefetch" href="/assets/js/67.5b575b21.js"><link rel="prefetch" href="/assets/js/68.f3b6f395.js"><link rel="prefetch" href="/assets/js/69.2c6ce239.js"><link rel="prefetch" href="/assets/js/7.d448298b.js"><link rel="prefetch" href="/assets/js/70.142aeb69.js"><link rel="prefetch" href="/assets/js/71.a3a3c331.js"><link rel="prefetch" href="/assets/js/72.c2f1a26e.js"><link rel="prefetch" href="/assets/js/73.8f72ade2.js"><link rel="prefetch" href="/assets/js/74.69faefcd.js"><link rel="prefetch" href="/assets/js/75.bf491959.js"><link rel="prefetch" href="/assets/js/76.54b30f01.js"><link rel="prefetch" href="/assets/js/77.9b2b976c.js"><link rel="prefetch" href="/assets/js/78.19096d31.js"><link rel="prefetch" href="/assets/js/79.ae5bc63c.js"><link rel="prefetch" href="/assets/js/8.04185565.js"><link rel="prefetch" href="/assets/js/9.30d66b6d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2e040761.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/hero.jpg" alt="叶旭瑶" class="logo"> <span class="site-name can-hide">叶旭瑶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航栏
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/我的学习笔记/" class="nav-link">
  博客总览
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/01-Some前端理念/" class="nav-link">
  01-Some前端理念
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/02-CSS美学/" class="nav-link">
  02-CSS美学
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/03-JavaScript永动机/" class="nav-link">
  03-JavaScript永动机
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/" class="nav-link">
  04-蒂姆·伯纳斯·李Browser
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/05-Plugin成就/" class="nav-link">
  05-Plugin成就
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/06-Vue全家桶精进之路/" class="nav-link">
  06-Vue全家桶精进之路
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/07-计算机常识积累/" class="nav-link">
  07-计算机常识积累
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷歌搜索
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航栏
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/我的学习笔记/" class="nav-link">
  博客总览
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/01-Some前端理念/" class="nav-link">
  01-Some前端理念
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/02-CSS美学/" class="nav-link">
  02-CSS美学
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/03-JavaScript永动机/" class="nav-link">
  03-JavaScript永动机
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/" class="nav-link">
  04-蒂姆·伯纳斯·李Browser
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/05-Plugin成就/" class="nav-link">
  05-Plugin成就
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/06-Vue全家桶精进之路/" class="nav-link">
  06-Vue全家桶精进之路
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/07-计算机常识积累/" class="nav-link">
  07-计算机常识积累
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷歌搜索
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/01-Some前端理念" class="sidebar-heading clickable"><span>01-Some前端理念</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/02-CSS美学" class="sidebar-heading clickable"><span>02-CSS美学</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/03-JavaScript永动机" class="sidebar-heading clickable open"><span>03-JavaScript永动机</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/我的学习笔记/03-JavaScript永动机/JS一些常用小tip.html" class="sidebar-link">JS一些常用小tip</a></li><li><a href="/我的学习笔记/03-JavaScript永动机/JS的对象Object.html" class="sidebar-link">JS的对象Object</a></li><li><a href="/我的学习笔记/03-JavaScript永动机/[01]初识JS.html" class="sidebar-link">[01]初识JS</a></li><li><a href="/我的学习笔记/03-JavaScript永动机/[20]ES6入门：Class的基本语法.html" class="sidebar-link">[20]ES6入门：Class的基本语法</a></li><li><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html" class="active sidebar-link">[21]ES6入门：Promise对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#基本用法" class="sidebar-link">基本用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#创建-promise-实例" class="sidebar-link">创建 Promise 实例</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#创建成功-失败回调函数" class="sidebar-link">创建成功/失败回调函数</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#案例" class="sidebar-link">案例</a></li></ul></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#promise-实例的方法" class="sidebar-link">Promise 实例的方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#promise-prototype-then" class="sidebar-link">Promise.prototype.then()</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#promise-prototype-catch" class="sidebar-link">Promise.prototype.catch()</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#案例-2" class="sidebar-link" style="padding-left:3rem;">案例</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#promise-prototype-finally" class="sidebar-link">Promise.prototype.finally()</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#promise-resolve" class="sidebar-link">Promise.resolve()</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#用法" class="sidebar-link" style="padding-left:3rem;">用法</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#参数" class="sidebar-link" style="padding-left:3rem;">参数</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#promise-reject" class="sidebar-link">Promise.reject()</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#promise-all" class="sidebar-link">Promise.all()</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#其他-了解" class="sidebar-link">其他(了解)</a></li></ul></li><li class="sidebar-sub-header"><a href="/我的学习笔记/03-JavaScript永动机/[21]ES6入门：Promise对象.html#实践记录" class="sidebar-link">实践记录</a></li></ul></li><li><a href="/我的学习笔记/03-JavaScript永动机/回调无处不在.html" class="sidebar-link">回调无处不在</a></li><li><a href="/我的学习笔记/03-JavaScript永动机/定时器与监听防抖.html" class="sidebar-link">定时器与监听防抖</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser" class="sidebar-heading clickable"><span>04-蒂姆·伯纳斯·李Browser</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/05-Plugin成就" class="sidebar-heading clickable"><span>05-Plugin成就</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/06-Vue全家桶精进之路" class="sidebar-heading clickable"><span>06-Vue全家桶精进之路</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/07-计算机常识积累" class="sidebar-heading clickable"><span>07-计算机常识积累</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_21-es6-入门-promise-对象"><a href="#_21-es6-入门-promise-对象" class="header-anchor">#</a> [21] ES6 入门：Promise 对象</h1> <p><em>2021 年 1 月 30 日</em></p> <hr> <p></p><div class="table-of-contents"><ul><li><a href="#_21-es6-入门-promise-对象">[21] ES6 入门：Promise 对象</a><ul><li><a href="#概念">概念</a></li><li><a href="#基本用法">基本用法</a><ul><li><a href="#创建-promise-实例">创建 Promise 实例</a></li><li><a href="#创建成功-失败回调函数">创建成功/失败回调函数</a></li><li><a href="#案例">案例</a></li></ul></li><li><a href="#promise-实例的方法">Promise 实例的方法</a><ul><li><a href="#promise-prototype-then">Promise.prototype.then()</a></li><li><a href="#promise-prototype-catch">Promise.prototype.catch()</a><ul><li><a href="#案例">案例</a></li></ul></li><li><a href="#promise-prototype-finally">Promise.prototype.finally()</a></li><li><a href="#promise-resolve">Promise.resolve()</a><ul><li><a href="#用法">用法</a></li><li><a href="#参数">参数</a></li></ul></li><li><a href="#promise-reject">Promise.reject()</a></li><li><a href="#promise-all">Promise.all()</a></li><li><a href="#其他-了解">其他(了解)</a></li></ul></li><li><a href="#实践记录">实践记录</a></li></ul></li><li><a href="#"></a></li></ul></div><p></p> <p><a href="https://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noopener noreferrer">Promise 对象<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <ul><li>Promise 对象代表一个异步操作，有<strong>三种状态</strong>：<strong>pending（进行中）</strong>、**fulfilled（已成功）**和 <strong>rejected（已失败）</strong>。</li> <li>只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。</li> <li><strong>Promise 对象的状态改变</strong>，只有两种可能：<strong>从 pending 变为 fulfilled</strong>和<strong>从 pending 变为 rejected</strong>。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果，这时就称为 <strong>resolved（已定型）</strong>。</li></ul> <h2 id="基本用法"><a href="#基本用法" class="header-anchor">#</a> 基本用法</h2> <h3 id="创建-promise-实例"><a href="#创建-promise-实例" class="header-anchor">#</a> 创建 Promise 实例</h3> <ul><li>Promise 对象是一个构造函数，用来生成 Promise 实例</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... some code</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/* 异步操作成功 */</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="创建成功-失败回调函数"><a href="#创建成功-失败回调函数" class="header-anchor">#</a> 创建成功/失败回调函数</h3> <ul><li>可以用 then 方法分别指定 resolved 状态和 rejected 状态的回调函数。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// success</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// failure</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h3> <ul><li>用 Promise 对象实现的 Ajax 操作</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getJSON</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">!==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    client<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Accept&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">&quot;/posts.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Contents: &quot;</span> <span class="token operator">+</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;出错了&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="promise-实例的方法"><a href="#promise-实例的方法" class="header-anchor">#</a> Promise 实例的方法</h2> <h3 id="promise-prototype-then"><a href="#promise-prototype-then" class="header-anchor">#</a> Promise.prototype.then()</h3> <ul><li>作用：为 Promise 实例添加状态改变时的回调函数。</li> <li>第一个参数是<strong>resolved 状态</strong>的回调函数</li> <li>第二个参数是<strong>rejected 状态</strong>的回调函数</li> <li>两个参数都是可选的。</li></ul> <h3 id="promise-prototype-catch"><a href="#promise-prototype-catch" class="header-anchor">#</a> Promise.prototype.catch()</h3> <ul><li>Promise.prototype.catch()方法是.then(null, rejection)或.then(undefined, rejection)的别名，用于指定发生错误时的回调函数。</li> <li>使用场景一：<strong>只定义了 resolved 回调函数，没有定义 rejected 回调函数，rejected 状态没有回调函数就会报错，从而被 catch 捕获</strong>。</li> <li>状态变为 resolved，则会调用 then()方法指定的回调函数；如果异步操作抛出错误，状态就会变为 rejected，就会调用 catch()方法指定的回调函数，处理这个错误。</li> <li>一般总是建议，<strong>Promise 对象后面要跟 catch()方法，这样可以处理 Promise 内部发生的错误</strong>。</li> <li><strong>catch()方法返回的还是一个 Promise 对象</strong>，因此后面还可以接着调用 then()方法。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">&quot;/posts.json&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolved</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理 getJSON 和 前一个回调函数运行时发生的错误</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;发生错误！&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>使用场景二：<strong>then()方法指定的回调函数</strong>(resolved 回调函数和 rejected 回调函数都定义了)，如果运行<strong>中抛出错误，也会被 catch()方法捕获</strong>。</li></ul> <h4 id="案例-2"><a href="#案例-2" class="header-anchor">#</a> 案例</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fulfilled:&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rejected&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fulfilled:&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rejected:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="promise-prototype-finally"><a href="#promise-prototype-finally" class="header-anchor">#</a> Promise.prototype.finally()</h3> <ul><li>finally()方法用于指定<strong>不管 Promise 对象最后状态如何，都会执行的操作</strong>。该方法是 <strong>ES2018 引入</strong>标准的。</li> <li>finally 方法总是会返回原来的值。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>promise
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>···<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>···<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>···<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="promise-resolve"><a href="#promise-resolve" class="header-anchor">#</a> Promise.resolve()</h3> <ul><li>将现有对象转为 Promise 对象。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 将 jQuery 生成的deferred对象，转为一个新的 Promise 对象。</span>
<span class="token keyword">const</span> jsPromise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">&quot;/whatever.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="用法"><a href="#用法" class="header-anchor">#</a> 用法</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等价于</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h4> <ul><li>如果<strong>参数是 Promise 实例</strong>，那么 Promise.resolve 将不做任何修改、原封不动地返回这个实例。</li> <li><strong>参数是一个 thenable 对象</strong>，thenable 对象指的是具有 then 方法的对象。Promise.resolve()方法会将这个对象转为 Promise 对象，然后就立即执行 thenable 对象的 then()方法。</li> <li><strong>参数是一个原始值，不是具有 then()方法的对象，或根本就不是对象</strong>，则 Promise.resolve()方法返回一个新的 Promise 对象，状态为 resolved。</li> <li><strong>不带有任何参数</strong>，直接返回一个 resolved 状态的 Promise 对象。</li></ul> <h3 id="promise-reject"><a href="#promise-reject" class="header-anchor">#</a> Promise.reject()</h3> <ul><li>Promise.reject(reason)方法也会返回一个新的 Promise 实例，该实例的状态为 rejected。</li> <li>Promise.reject()方法的<strong>参数，会原封不动地作为 reject 的理由，变成后续方法的参数</strong>。</li> <li>Promise.reject()方法的参数是一个字符串，后面 catch()方法的参数 e 就是这个字符串。</li></ul> <h3 id="promise-all"><a href="#promise-all" class="header-anchor">#</a> Promise.all()</h3> <ul><li><strong>Promise.all()方法用于将多个 Promise 实例，包装成一个新的 Promise 实例</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>p 的状态由 p1、p2、p3 决定，分成两种情况。</li> <li>只有<strong>p1、p2、p3 的状态都变成 fulfilled，p 的状态才会变成 fulfilled</strong>，此时 p1、p2、p3 的返回值组成一个数组，传递给 p 的回调函数。</li> <li>只要<strong>p1、p2、p3 之中有一个被 rejected，p 的状态就变成 rejected</strong>，此时第一个被 reject 的实例的返回值，会传递给 p 的回调函数。</li></ul> <h3 id="其他-了解"><a href="#其他-了解" class="header-anchor">#</a> 其他(了解)</h3> <ul><li><code>Promise.race()</code>方法也是将多个 Promise 实例，包装成一个新的 Promise 实例。</li> <li><code>Promise.allSettled()</code>方法接受一组 Promise 实例作为参数，包装成一个新的 Promise 实例。只有等到所有这些参数实例都返回结果，不管是 fulfilled 还是 rejected，包装实例才会结束。</li> <li><code>Promise.any()</code>方法接受一组 Promise 实例作为参数，包装成一个新的 Promise 实例返回。只要参数实例有一个变成 fulfilled 状态，包装实例就会变成 fulfilled 状态；如果所有参数实例都变成 rejected 状态，包装实例就会变成 rejected 状态。</li></ul> <h2 id="实践记录"><a href="#实践记录" class="header-anchor">#</a> 实践记录</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> httpRequest <span class="token operator">=</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> errorTitle <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> method <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//统一转为小写</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_axiosInstance
        <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          url<span class="token punctuation">,</span>
          method<span class="token punctuation">,</span>
          <span class="token comment">// params: data,</span>
          params<span class="token operator">:</span> method <span class="token operator">===</span> <span class="token string">&quot;get&quot;</span> <span class="token operator">?</span> data <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          data<span class="token operator">:</span> method <span class="token operator">!==</span> <span class="token string">&quot;get&quot;</span> <span class="token operator">?</span> data <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">//这里的status是和后端约定的</span>
          <span class="token comment">// console.log(&quot;请求结束了&quot;);</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;fail&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;网络异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">//本意应该是上一层then里发生了错误的处理</span>
          <span class="token comment">//所以上一层then没有写reject报错就会被抛到catch来,所以建议上一层的promise一定要写reject</span>
          <span class="token comment">//测试时抛出来看，正常使用的时候这里不写放空，甚至不catch，这样用户就看不到</span>
          <span class="token comment">//甚至可以在这里做个错误日志埋点。当用户出现报错时，将catch发送到服务器</span>
          <span class="token comment">// 出错时打印错误</span>
          <span class="token keyword">const</span> tip <span class="token operator">=</span> <span class="token string">&quot;请求&quot;</span> <span class="token operator">+</span> errorTitle <span class="token operator">+</span> <span class="token string">&quot;失败&quot;</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tip<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h1 id=""><a href="#" class="header-anchor">#</a></h1> <hr> <p><em>Copyright © 2020 - 2021 by 叶旭瑶 . All Rights Reserved .</em></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/我的学习笔记/03-JavaScript永动机/[20]ES6入门：Class的基本语法.html" class="prev">
        [20]ES6入门：Class的基本语法
      </a></span> <span class="next"><a href="/我的学习笔记/03-JavaScript永动机/回调无处不在.html">
        回调无处不在
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a8df1c95.js" defer></script><script src="/assets/js/2.48d09664.js" defer></script><script src="/assets/js/31.32df4c34.js" defer></script>
  </body>
</html>
