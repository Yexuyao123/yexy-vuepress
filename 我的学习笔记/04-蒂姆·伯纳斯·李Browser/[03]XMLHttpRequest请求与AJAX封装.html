<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[03] XMLHttpRequest 请求与 AJAX 封装 | 叶旭瑶</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.2e040761.css" as="style"><link rel="preload" href="/assets/js/app.a8df1c95.js" as="script"><link rel="preload" href="/assets/js/2.48d09664.js" as="script"><link rel="preload" href="/assets/js/37.fe07ec53.js" as="script"><link rel="prefetch" href="/assets/js/10.90ae3223.js"><link rel="prefetch" href="/assets/js/11.60747cf8.js"><link rel="prefetch" href="/assets/js/12.78613ebb.js"><link rel="prefetch" href="/assets/js/13.15cefad8.js"><link rel="prefetch" href="/assets/js/14.2706d9af.js"><link rel="prefetch" href="/assets/js/15.4a1534b3.js"><link rel="prefetch" href="/assets/js/16.667b9eec.js"><link rel="prefetch" href="/assets/js/17.2f6f2fb7.js"><link rel="prefetch" href="/assets/js/18.ae0db680.js"><link rel="prefetch" href="/assets/js/19.3a1a9b2b.js"><link rel="prefetch" href="/assets/js/20.b37fd568.js"><link rel="prefetch" href="/assets/js/21.00e571a2.js"><link rel="prefetch" href="/assets/js/22.7113929a.js"><link rel="prefetch" href="/assets/js/23.76749a7b.js"><link rel="prefetch" href="/assets/js/24.d64a7195.js"><link rel="prefetch" href="/assets/js/25.dd0efafa.js"><link rel="prefetch" href="/assets/js/26.b526a833.js"><link rel="prefetch" href="/assets/js/27.0d7e1a2b.js"><link rel="prefetch" href="/assets/js/28.ff5daa9c.js"><link rel="prefetch" href="/assets/js/29.6b832bc1.js"><link rel="prefetch" href="/assets/js/3.dc0eeb90.js"><link rel="prefetch" href="/assets/js/30.9473db5d.js"><link rel="prefetch" href="/assets/js/31.32df4c34.js"><link rel="prefetch" href="/assets/js/32.e34273e7.js"><link rel="prefetch" href="/assets/js/33.4d28e2f8.js"><link rel="prefetch" href="/assets/js/34.e19c3a87.js"><link rel="prefetch" href="/assets/js/35.ae6f54a4.js"><link rel="prefetch" href="/assets/js/36.c311869c.js"><link rel="prefetch" href="/assets/js/38.b9b76405.js"><link rel="prefetch" href="/assets/js/39.ce5b3eb6.js"><link rel="prefetch" href="/assets/js/4.52766d3a.js"><link rel="prefetch" href="/assets/js/40.c28128a5.js"><link rel="prefetch" href="/assets/js/41.baa5b9df.js"><link rel="prefetch" href="/assets/js/42.e9dd8626.js"><link rel="prefetch" href="/assets/js/43.1870fb99.js"><link rel="prefetch" href="/assets/js/44.5f5cadd9.js"><link rel="prefetch" href="/assets/js/45.6e86d635.js"><link rel="prefetch" href="/assets/js/46.6f9e3d5c.js"><link rel="prefetch" href="/assets/js/47.da89bc26.js"><link rel="prefetch" href="/assets/js/48.29abeeb3.js"><link rel="prefetch" href="/assets/js/49.82a3a29d.js"><link rel="prefetch" href="/assets/js/5.9eccb937.js"><link rel="prefetch" href="/assets/js/50.b2028d20.js"><link rel="prefetch" href="/assets/js/51.9208c15a.js"><link rel="prefetch" href="/assets/js/52.db1c8ad3.js"><link rel="prefetch" href="/assets/js/53.2c6c7978.js"><link rel="prefetch" href="/assets/js/54.4a5fc56a.js"><link rel="prefetch" href="/assets/js/55.43d12619.js"><link rel="prefetch" href="/assets/js/56.f78e78dd.js"><link rel="prefetch" href="/assets/js/57.b92e209e.js"><link rel="prefetch" href="/assets/js/58.6b552921.js"><link rel="prefetch" href="/assets/js/59.90266c96.js"><link rel="prefetch" href="/assets/js/6.710abc21.js"><link rel="prefetch" href="/assets/js/60.fb66ef65.js"><link rel="prefetch" href="/assets/js/61.82cc26c2.js"><link rel="prefetch" href="/assets/js/62.a0a80205.js"><link rel="prefetch" href="/assets/js/63.dda7942d.js"><link rel="prefetch" href="/assets/js/64.0a5e6f5b.js"><link rel="prefetch" href="/assets/js/65.fb8144ce.js"><link rel="prefetch" href="/assets/js/66.8a1226d0.js"><link rel="prefetch" href="/assets/js/67.5b575b21.js"><link rel="prefetch" href="/assets/js/68.f3b6f395.js"><link rel="prefetch" href="/assets/js/69.2c6ce239.js"><link rel="prefetch" href="/assets/js/7.d448298b.js"><link rel="prefetch" href="/assets/js/70.142aeb69.js"><link rel="prefetch" href="/assets/js/71.a3a3c331.js"><link rel="prefetch" href="/assets/js/72.c2f1a26e.js"><link rel="prefetch" href="/assets/js/73.8f72ade2.js"><link rel="prefetch" href="/assets/js/74.69faefcd.js"><link rel="prefetch" href="/assets/js/75.bf491959.js"><link rel="prefetch" href="/assets/js/76.54b30f01.js"><link rel="prefetch" href="/assets/js/77.9b2b976c.js"><link rel="prefetch" href="/assets/js/78.19096d31.js"><link rel="prefetch" href="/assets/js/79.ae5bc63c.js"><link rel="prefetch" href="/assets/js/8.04185565.js"><link rel="prefetch" href="/assets/js/9.30d66b6d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2e040761.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/hero.jpg" alt="叶旭瑶" class="logo"> <span class="site-name can-hide">叶旭瑶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航栏
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/我的学习笔记/" class="nav-link">
  博客总览
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/01-Some前端理念/" class="nav-link">
  01-Some前端理念
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/02-CSS美学/" class="nav-link">
  02-CSS美学
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/03-JavaScript永动机/" class="nav-link">
  03-JavaScript永动机
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/" class="nav-link">
  04-蒂姆·伯纳斯·李Browser
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/05-Plugin成就/" class="nav-link">
  05-Plugin成就
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/06-Vue全家桶精进之路/" class="nav-link">
  06-Vue全家桶精进之路
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/07-计算机常识积累/" class="nav-link">
  07-计算机常识积累
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷歌搜索
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航栏
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/我的学习笔记/" class="nav-link">
  博客总览
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/01-Some前端理念/" class="nav-link">
  01-Some前端理念
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/02-CSS美学/" class="nav-link">
  02-CSS美学
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/03-JavaScript永动机/" class="nav-link">
  03-JavaScript永动机
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/" class="nav-link">
  04-蒂姆·伯纳斯·李Browser
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/05-Plugin成就/" class="nav-link">
  05-Plugin成就
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/06-Vue全家桶精进之路/" class="nav-link">
  06-Vue全家桶精进之路
</a></li><li class="dropdown-item"><!----> <a href="/我的学习笔记/07-计算机常识积累/" class="nav-link">
  07-计算机常识积累
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  谷歌搜索
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/01-Some前端理念" class="sidebar-heading clickable"><span>01-Some前端理念</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/02-CSS美学" class="sidebar-heading clickable"><span>02-CSS美学</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/03-JavaScript永动机" class="sidebar-heading clickable"><span>03-JavaScript永动机</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser" class="sidebar-heading clickable open"><span>04-蒂姆·伯纳斯·李Browser</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[01]markdown格式整理.html" class="sidebar-link">[01]markdown格式整理</a></li><li><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[02]输入URL到页面展示.html" class="sidebar-link">[02]输入URL到页面展示</a></li><li><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html" class="active sidebar-link">[03]XMLHttpRequest请求与AJAX封装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_1-相关基础" class="sidebar-link">1.相关基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#请求与响应" class="sidebar-link">请求与响应</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_1、请求的格式【request】" class="sidebar-link" style="padding-left:3rem;">1、请求的格式【request】</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_2、响应的格式【response】" class="sidebar-link" style="padding-left:3rem;">2、响应的格式【response】</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_3、get-请求和-post-请求的区别" class="sidebar-link" style="padding-left:3rem;">3、GET 请求和 POST 请求的区别</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#如何发请求" class="sidebar-link">如何发请求？</a></li></ul></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_2-ajax" class="sidebar-link">2.AJAX</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#ajax-定义" class="sidebar-link">AJAX 定义</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#xmlhttprequest-构造函数" class="sidebar-link">XMLHttpRequest 构造函数</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#使用-xmlhttprequest-发请求" class="sidebar-link">使用 XMLHttpRequest 发请求</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_1-request-open-配置" class="sidebar-link" style="padding-left:3rem;">① request.open() 配置</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_2-查看-request-的-api" class="sidebar-link" style="padding-left:3rem;">② 查看 request 的 API</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_3-request-readystate" class="sidebar-link" style="padding-left:3rem;">③ request.readyState</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_4-request-onreadystatechange-监听状态改变" class="sidebar-link" style="padding-left:3rem;">④ request.onreadystatechange 监听状态改变</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_5-request-setrequestheader-header-value-设置请求头" class="sidebar-link" style="padding-left:3rem;">⑤ request.setRequestHeader(header, value)设置请求头</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_6-request-send-body-设置请求体并将请求发送到服务器" class="sidebar-link" style="padding-left:3rem;">⑥ request.send(body) 设置请求体并将请求发送到服务器</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_7-获取响应内容" class="sidebar-link" style="padding-left:3rem;">⑦ 获取响应内容</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_8-总结" class="sidebar-link" style="padding-left:3rem;">⑧ 总结：</a></li></ul></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_3-json" class="sidebar-link">3.JSON</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#json-的发明" class="sidebar-link">JSON 的发明</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#json-语法" class="sidebar-link">JSON 语法</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#json-使用" class="sidebar-link">JSON 使用</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#json-相关-api" class="sidebar-link">JSON 相关 API</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#处理服务器响应的-json-字符串" class="sidebar-link" style="padding-left:3rem;">处理服务器响应的 json 字符串</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#js-对象-与-json-字符串-相互转化" class="sidebar-link" style="padding-left:3rem;">JS 对象 与 JSON 字符串 相互转化</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#json-字符串-js-对象" class="sidebar-link" style="padding-left:4rem;">JSON 字符串——&gt;JS 对象</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#js-对象-json-字符串" class="sidebar-link" style="padding-left:4rem;">JS 对象——&gt;JSON 字符串</a></li></ul></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_4-跨域问题" class="sidebar-link">4.跨域问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#ajax-不能跨域请求" class="sidebar-link">AJAX 不能跨域请求</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#同源策略" class="sidebar-link">同源策略</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#让-ajax-可以跨域请求" class="sidebar-link">让 AJAX 可以跨域请求</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#ajax-与-jsonp-比较" class="sidebar-link">AJAX 与 JSONP 比较</a></li></ul></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#_5-promise" class="sidebar-link">5.Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#jquery-的-promise" class="sidebar-link">jQuery 的 Promise</a></li><li class="sidebar-sub-header"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[03]XMLHttpRequest请求与AJAX封装.html#自己封装实现-promise" class="sidebar-link">自己封装实现 Promise</a></li></ul></li></ul></li><li><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[04]请求响应头与JSONP前后端分离.html" class="sidebar-link">[04]请求响应头与JSONP前后端分离</a></li><li><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[05]Cookie与浏览器HTTP缓存控制.html" class="sidebar-link">[05]Cookie与浏览器HTTP缓存控制</a></li><li><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[06]Session服务器缓存.html" class="sidebar-link">[06]Session服务器缓存</a></li><li><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[07]LocalStorage与SessionStorage的使用.html" class="sidebar-link">[07]LocalStorage与SessionStorage的使用</a></li><li><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[08]JWT实现token验证.html" class="sidebar-link">[08]JWT实现token验证</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/05-Plugin成就" class="sidebar-heading clickable"><span>05-Plugin成就</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/06-Vue全家桶精进之路" class="sidebar-heading clickable"><span>06-Vue全家桶精进之路</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/我的学习笔记/07-计算机常识积累" class="sidebar-heading clickable"><span>07-计算机常识积累</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_03-xmlhttprequest-请求与-ajax-封装"><a href="#_03-xmlhttprequest-请求与-ajax-封装" class="header-anchor">#</a> [03] XMLHttpRequest 请求与 AJAX 封装</h1> <p><em>2021 年 1 月 10 日</em></p> <hr> <p></p><div class="table-of-contents"><ul><li><a href="#_03-xmlhttprequest-请求与-ajax-封装">[03] XMLHttpRequest 请求与 AJAX 封装</a><ul><li><a href="#_1-相关基础">1.相关基础</a><ul><li><a href="#请求与响应">请求与响应</a><ul><li><a href="#_1、请求的格式【request】">1、请求的格式【request】</a></li><li><a href="#_2、响应的格式【response】">2、响应的格式【response】</a></li><li><a href="#_3、get-请求和-post-请求的区别">3、GET 请求和 POST 请求的区别</a></li></ul></li><li><a href="#如何发请求">如何发请求？</a></li></ul></li><li><a href="#_2-ajax">2.AJAX</a><ul><li><a href="#ajax-定义">AJAX 定义</a></li><li><a href="#xmlhttprequest-构造函数">XMLHttpRequest 构造函数</a></li><li><a href="#使用-xmlhttprequest-发请求">使用 XMLHttpRequest 发请求</a><ul><li><a href="#_1-request-open-配置">① request.open() 配置</a></li><li><a href="#_2-查看-request-的-api">② 查看 request 的 API</a></li><li><a href="#_3-request-readystate">③ request.readyState</a></li><li><a href="#_4-request-onreadystatechange-监听状态改变">④ request.onreadystatechange 监听状态改变</a></li><li><a href="#_5-request-setrequestheader-header-value-设置请求头">⑤ request.setRequestHeader(header, value)设置请求头</a></li><li><a href="#_6-request-send-body-设置请求体并将请求发送到服务器">⑥ request.send(body) 设置请求体并将请求发送到服务器</a></li><li><a href="#_7-获取响应内容">⑦ 获取响应内容</a></li><li><a href="#_8-总结">⑧ 总结：</a></li></ul></li></ul></li><li><a href="#_3-json">3.JSON</a><ul><li><a href="#json-的发明">JSON 的发明</a></li><li><a href="#json-语法">JSON 语法</a></li><li><a href="#json-使用">JSON 使用</a></li><li><a href="#json-相关-api">JSON 相关 API</a><ul><li><a href="#处理服务器响应的-json-字符串">处理服务器响应的 json 字符串</a></li><li><a href="#js-对象-与-json-字符串-相互转化">JS 对象 与 JSON 字符串 相互转化</a></li></ul></li></ul></li><li><a href="#_4-跨域问题">4.跨域问题</a><ul><li><a href="#ajax-不能跨域请求">AJAX 不能跨域请求</a></li><li><a href="#同源策略">同源策略</a></li><li><a href="#让-ajax-可以跨域请求">让 AJAX 可以跨域请求</a></li><li><a href="#ajax-与-jsonp-比较">AJAX 与 JSONP 比较</a></li></ul></li><li><a href="#_5-promise">5.Promise</a><ul><li><a href="#jquery-的-promise">jQuery 的 Promise</a></li><li><a href="#自己封装实现-promise">自己封装实现 Promise</a></li></ul></li></ul></li></ul></div><p></p> <p>前言：</p> <ul><li><p>1999 年，允许 JavaScript 脚本向服务器发起 HTTP 请求。</p></li> <li><p>2005 年 2 月，AJAX 这个词第一次正式提出。</p></li> <li><p>AJAX (Asynchronous JavaScript and XML 译：异步的 JavaScript 和 XML)，指通过 JavaScript 的异步通信，从服务器获取 XML 文档从中提取数据，再更新当前网页的对应部分，而不用刷新整个网页。</p></li> <li><p>后来，AJAX 这个词就成为 JavaScript 脚本发起 HTTP 通信的代名词，也就是说，只要用脚本发起通信，就可以叫做 AJAX 通信。</p></li> <li><p><a href="https://javascript.ruanyifeng.com/bom/ajax.html#toc0" target="_blank" rel="noopener noreferrer">JavaScript 标准参考教程 &gt; 浏览器环境 &gt; AJAX —— 阮一峰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://wangdoc.com/javascript/bom/xmlhttprequest.html" target="_blank" rel="noopener noreferrer">网道 —— XMLHttpRequest 对象<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <p>摘要：</p> <ol><li>创建 XMLHttpRequest 实例</li> <li>发出 HTTP 请求</li> <li>接收服务器传回的数据</li> <li>更新网页数据</li></ol> <h2 id="_1-相关基础"><a href="#_1-相关基础" class="header-anchor">#</a> 1.相关基础</h2> <h3 id="请求与响应"><a href="#请求与响应" class="header-anchor">#</a> 请求与响应</h3> <h4 id="_1、请求的格式【request】"><a href="#_1、请求的格式【request】" class="header-anchor">#</a> 1、请求的格式【request】</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>1 动词 路径协议/版本
2 Key1: value1
2 Key2: value2
2 Key3: value3
2 Content-Type: application/x-www-form-urlencoded
2 Host: www.baidu.com
2 User-Agent: curl/7.54.0
3
4 要上传的数据
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注意：</p> <ol><li>动词： GET POST PUT PATCH DELETE HEAD OPTIONS 等;</li> <li>路径包括「查询参数」，不包括「锚点」,如果没写路径，那么路径默认为 /</li> <li>第 2 部分中的 Content-Type 标注了第 4 部分的格式</li> <li>第三部分永远都是一个回车（\n）</li> <li>OPTIONS 请求：</li></ol> <p>OPTIONS 请求方法的主要用途有两个：</p> <ul><li>获取服务器支持的 HTTP 请求方法；</li> <li>用来检查服务器的性能。</li></ul> <p>Preflighted Requests(预检请求)是 CORS 中一种透明服务器验证机制。
首先需要向另外一个域名的资源发送一个 HTTP OPTIONS 请求头，其目的就是为了判断实际发送的请求是否是安全的。下面的 2 种情况需要进行预检：</p> <ul><li>简单请求，比如使用 Content-Type 为 application/xml 或 text/xml 的 POST 请求；</li> <li>中设置自定义头，比如 X-JSON、X-MENGXIANHUI 等。</li></ul> <h4 id="_2、响应的格式【response】"><a href="#_2、响应的格式【response】" class="header-anchor">#</a> 2、响应的格式【response】</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>1 协议/版本号 状态码状态 解释
2 Key1: value1
2 Key2: value2
2 Content-Length: 17931
2 Content-Type: text/html
3
4 要下载的内容
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>注意：</p> <ol><li>状态码(服务器对浏览器说的话):
<ul><li>1xx 不常用</li> <li>2xx 表示成功</li> <li>3xx 表示滚吧</li> <li>4xx 客户端出错</li> <li>5xx 服务器出错</li></ul></li> <li>第 2 部分中的 Content-Type 标注了第 4 部分的格式</li> <li>第三部分永远都是一个回车（\n）</li></ol> <h4 id="_3、get-请求和-post-请求的区别"><a href="#_3、get-请求和-post-请求的区别" class="header-anchor">#</a> 3、GET 请求和 POST 请求的区别</h4> <p>1、GET 请求常用于不上传数据时，上传数据时默认将数据携带于 URL 中
2、POST 请求常用与上传数据时，上传数据默认将数据携带在请求的第 4 部分</p> <h3 id="如何发请求"><a href="#如何发请求" class="header-anchor">#</a> 如何发请求？</h3> <ol><li>用 form 可以发请求，但是会刷新页面或新开页面</li> <li>用 a 可以发 get 请求，但是也会刷新页面或新开页面</li> <li>用 img 可以发 get 请求，但是只能以图片的形式展示</li> <li>用 link 可以发 get 请求，但是只能以 CSS、favicon 的形式展示</li> <li>用 script 可以发 get 请求，但是只能以脚本的形式运行</li></ol> <h2 id="_2-ajax"><a href="#_2-ajax" class="header-anchor">#</a> 2.AJAX</h2> <h3 id="ajax-定义"><a href="#ajax-定义" class="header-anchor">#</a> AJAX 定义</h3> <p>Jesse James Garrett 将使用如下 3 个技术：</p> <ol><li>使用 XMLHttpRequest 发请求</li> <li>服务器返回 XML 格式的字符串（最初是用来传 XML 格式的）</li> <li>JS 解析 XML，并更新局部页面</li></ol> <p>的方案取名叫做 AJAX：Asynchronous JavaScript and XML(异步的 JavaScript 和 XML)</p> <h3 id="xmlhttprequest-构造函数"><a href="#xmlhttprequest-构造函数" class="header-anchor">#</a> XMLHttpRequest 构造函数</h3> <p><code>window.XMLHttpRequest</code>是一个对象/构造函数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 查看 XMLHttpRequest 的 API</span>
<span class="token keyword">const</span> <span class="token constant">XXX</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">XXX</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="使用-xmlhttprequest-发请求"><a href="#使用-xmlhttprequest-发请求" class="header-anchor">#</a> 使用 XMLHttpRequest 发请求</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>yexy<span class="token punctuation">.</span>button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/yyyexy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 配置</span>
  request<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置请求头</span>
  request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置第4部分，发送请求</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_1-request-open-配置"><a href="#_1-request-open-配置" class="header-anchor">#</a> ① request.open() 配置</h4> <p><strong>用于设置 请求方法/URL</strong></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>
            method<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span>
            url<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span>
            <span class="token keyword">async</span><span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">boolean</span><span class="token punctuation">,</span> <span class="token comment">// 是否异步，默认异步</span>
            user<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span>
            password<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span>
            <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/open" target="_blank" rel="noopener noreferrer">XMLHttpRequest.open()——MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_2-查看-request-的-api"><a href="#_2-查看-request-的-api" class="header-anchor">#</a> ② 查看 request 的 API</h4> <p><code>console.log(request)</code>得到<code>XMLHttpRequest { … }</code>对象 API 如下：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 监听状态</span>
onabort<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// 被中断</span>
onerror<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">//加载错误</span>
onload<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// 加载成功</span>
onloadend<span class="token operator">:</span> <span class="token keyword">null</span>
onloadstart<span class="token operator">:</span> <span class="token keyword">null</span>
onprogress<span class="token operator">:</span> <span class="token keyword">null</span>
onreadystatechange<span class="token operator">:</span> <span class="token keyword">null</span>
ontimeout<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">//超时</span>
readyState<span class="token operator">:</span> <span class="token number">4</span>  <span class="token comment">// 读取进度</span>

<span class="token comment">// 响应内容</span>
response<span class="token operator">:</span> <span class="token string">&quot;呜呜呜，我收到 AJAX 请求了&quot;</span>
responseText<span class="token operator">:</span> <span class="token string">&quot;呜呜呜，我收到 AJAX 请求了&quot;</span>
responseType<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
responseURL<span class="token operator">:</span> <span class="token string">&quot;localhost:8888/yyyexy&quot;</span>
responseXML<span class="token operator">:</span> <span class="token keyword">null</span>

<span class="token comment">// 状态码</span>
status<span class="token operator">:</span> <span class="token number">200</span>
statusText<span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>

<span class="token comment">// 请求超时前等待的毫秒数</span>
timeout<span class="token operator">:</span> <span class="token number">0</span>

upload<span class="token operator">:</span> XMLHttpRequestUpload <span class="token punctuation">{</span> … <span class="token punctuation">}</span>
  onabort<span class="token operator">:</span> <span class="token keyword">null</span>
  onerror<span class="token operator">:</span> <span class="token keyword">null</span>
  onload<span class="token operator">:</span> <span class="token keyword">null</span>
  onloadend<span class="token operator">:</span> <span class="token keyword">null</span>
  onloadstart<span class="token operator">:</span> <span class="token keyword">null</span>
  onprogress<span class="token operator">:</span> <span class="token keyword">null</span>
  ontimeout<span class="token operator">:</span> <span class="token keyword">null</span>
  __proto__<span class="token operator">:</span> XMLHttpRequestUpload

<span class="token comment">// 是否跨域请求</span>
withCredentials<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token comment">// 原型</span>
__proto__<span class="token operator">:</span> XMLHttpRequest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h4 id="_3-request-readystate"><a href="#_3-request-readystate" class="header-anchor">#</a> ③ request.readyState</h4> <table><thead><tr><th style="text-align:center;">值</th> <th style="text-align:center;">状态</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">0</td> <td style="text-align:center;">UNSENT(未打开)</td> <td style="text-align:center;">代理被创建，但尚未调用 open() 方法。</td></tr> <tr><td style="text-align:center;">1</td> <td style="text-align:center;">OPENED(未发送)</td> <td style="text-align:center;">open() 方法已经被调用，但尚未调用 send() 方法。</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">HEADERS_RECEIVED(已获取响应头)</td> <td style="text-align:center;">send() 方法已经被调用，并且头部和状态已经可获得。</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">LOADING(正在下载响应体)</td> <td style="text-align:center;">响应体下载中； responseText 属性已经包含部分数据。</td></tr> <tr><td style="text-align:center;">4</td> <td style="text-align:center;">DONE(请求完成)</td> <td style="text-align:center;">下载操作已完成。</td></tr></tbody></table> <p>细节：</p> <ol><li>状态 2(已获取响应头) 和状态 3(正在下载响应体)
说明响应并不是一次性返回的，响应是分步返回的，当响应体很大时，是可以分次返回的。</li> <li>获取到响应状态码 200 只能表示服务器统一这次响应，并不代表请求成功获得响应。</li> <li>状态 4(请求完成) 表示响应体已经全部下载完成，这是才能确认请求的响应是成功的。</li></ol> <h4 id="_4-request-onreadystatechange-监听状态改变"><a href="#_4-request-onreadystatechange-监听状态改变" class="header-anchor">#</a> ④ request.onreadystatechange 监听状态改变</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求响应都结束了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">299</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求成功了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;收到响应的内容：&quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求失败了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_5-request-setrequestheader-header-value-设置请求头"><a href="#_5-request-setrequestheader-header-value-设置请求头" class="header-anchor">#</a> ⑤ request.setRequestHeader(header, value)设置请求头</h4> <ul><li><strong>请求的第 2 部分 key:value 都有可以通过.setRequestHeader 来设置</strong></li> <li><code>request.setRequestHeader(&quot;Content-Type&quot;,&quot; application/x-www-form-urlencoded&quot;);</code></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/setRequestHeader" target="_blank" rel="noopener noreferrer">XMLHttpRequest.setRequestHeaderd()——MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>设置 HTTP 请求头部的方法。</li> <li>此方法必须在 open()方法和 send()之间调用。</li> <li>如果多次对同一个请求头赋值，只会生成一个合并了多个值的请求头。</li> <li>注意：</li> <li>自定义一些 header 属性进行跨域请求时，可能会遇到不允许跨域请求，需要在服务端设置&quot;Access-Control-Allow-Headers&quot;。</li></ul> <h4 id="_6-request-send-body-设置请求体并将请求发送到服务器"><a href="#_6-request-send-body-设置请求体并将请求发送到服务器" class="header-anchor">#</a> ⑥ request.send(body) 设置请求体并将请求发送到服务器</h4> <ul><li><strong>用于设置 POST 请求的第 4 部分</strong></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/send" target="_blank" rel="noopener noreferrer">XMLHttpRequest.send()——MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><p>The XMLHttpRequest method send() sends the request to the server.
If the request is asynchronous (which is the default), this method returns as soon as the request is sent and the result is delivered using events. If the request is synchronous, this method doesn't return until the response has arrived.</p></blockquote> <ul><li><code>request.send()</code> 的返回值(ReturnValue) 是 <code>undefined</code>。</li> <li>如果请求是异步的（默认），则此方法将在 请求被发送 且 使用事件传递结果 时返回。</li> <li>如果请求是同步的，则该方法在响应到达后返回。</li></ul> <h4 id="_7-获取响应内容"><a href="#_7-获取响应内容" class="header-anchor">#</a> ⑦ 获取响应内容</h4> <ol><li><code>request.status</code> //响应的状态码 200</li> <li><code>request.statusText</code> // 响应状态解释 OK</li> <li><code>request.getAllResponseHeaders()</code> 获取响应头
<code>console.log(request.getAllResponseHeaders())</code></li> <li><code>request.getAllResponseHeaders(&quot;Content-Type&quot;)</code> //获取响应头中的 Content-Type</li> <li><code>request.responseText</code> // 获取响应的内容
<code>const repText = request.responseText</code></li></ol> <h4 id="_8-总结"><a href="#_8-总结" class="header-anchor">#</a> ⑧ 总结：</h4> <p><strong>通过 AJAX 可以设置请求的 4 个部分，也可以获取响应的 4 个部分</strong></p> <ol><li><p>JS 可以设置任意请求 header 吗
第一部分 request.open('get', '/xxx')
第二部分 request.setRequestHeader('content-type','x-www-form-urlencoded')
第四部分 request.send('a=1&amp;b=2')</p></li> <li><p>JS 可以获取任意响应 header 吗？
第一部分 request.status / request.statusText
第二部分 request.getResponseHeader() / request.getAllResponseHeaders()
第四部分 request.responseText</p></li></ol> <h2 id="_3-json"><a href="#_3-json" class="header-anchor">#</a> 3.JSON</h2> <p>由于最初发明 AJAX 时只有 XML，HTML 尚未发明，所以服务器必须返回 XML 格式的字符串。
但是无论是 XML 还是 HTML，都是 DOM 文档，需要后续处理取出 DOM，很麻烦。
如果有一种更加简便的方式去传递数据就更好了！
于是 JSON 语言被发明。</p> <h3 id="json-的发明"><a href="#json-的发明" class="header-anchor">#</a> JSON 的发明</h3> <ul><li>JSON：JavaScript Object Notation, JS 对象简谱，是一种轻量级的数据交换格式。</li> <li>它基于 ECMAScript 的一个子集，采用完全独立于编程语言的文本格式来存储和表示数据。</li> <li>发明人：Douglas Crockford (道格拉斯 克罗克福德)</li> <li>优点：易于人阅读和编写，同时也易于机器解析和生成，并有效地提升网络传输效率。</li></ul> <h3 id="json-语法"><a href="#json-语法" class="header-anchor">#</a> JSON 语法</h3> <ul><li><a href="http://www.json.org.cn/" target="_blank" rel="noopener noreferrer">JSON 中文官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.json.org/" target="_blank" rel="noopener noreferrer">JSON 英文官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>总结：</p> <ol><li>JSON 没有抄袭 JS 中的 function 和 undefined</li> <li>JSON 的字符串首尾必须是双引号&quot;</li> <li>比较：</li></ol> <table><thead><tr><th style="text-align:center;">比较</th> <th style="text-align:center;">JS</th> <th style="text-align:center;">JSON</th></tr></thead> <tbody><tr><td style="text-align:center;">字符串</td> <td style="text-align:center;">'yexy'</td> <td style="text-align:center;">&quot;yexy&quot;</td></tr> <tr><td style="text-align:center;">未定义</td> <td style="text-align:center;">undefined</td> <td style="text-align:center;">没有</td></tr> <tr><td style="text-align:center;">空</td> <td style="text-align:center;">null</td> <td style="text-align:center;">null</td></tr> <tr><td style="text-align:center;">数组</td> <td style="text-align:center;">['a','b']</td> <td style="text-align:center;">[&quot;a&quot;,&quot;b&quot;]</td></tr> <tr><td style="text-align:center;">对象</td> <td style="text-align:center;">{name:&quot;yexy&quot;}</td> <td style="text-align:center;">{&quot;name&quot;:&quot;yexy&quot;}</td></tr> <tr><td style="text-align:center;">函数</td> <td style="text-align:center;">function(){}</td> <td style="text-align:center;">没有</td></tr> <tr><td style="text-align:center;">声明</td> <td style="text-align:center;">var a = {}</td> <td style="text-align:center;">JSON 没有变量</td></tr> <tr><td style="text-align:center;">原型链</td> <td style="text-align:center;">__ proto __</td> <td style="text-align:center;">JSON 没有原型链</td></tr></tbody></table> <ol start="4"><li>JSON 不是编程语言，JSON 是数据格式化语言</li> <li>JSON 不能表示复杂对象，只能表示哈希</li></ol> <h3 id="json-使用"><a href="#json-使用" class="header-anchor">#</a> JSON 使用</h3> <ul><li>服务端设置响应文本类型</li> <li><code>response.setHeader ('Content-Type' , 'text/json ; charset = utf-8')</code></li> <li>用 JSON 文本替换 XML 文本</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// XML文本</span>
<span class="token operator">&lt;</span>node<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>to<span class="token operator">&gt;</span>Linzhihui<span class="token operator">&lt;</span><span class="token operator">/</span>to<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token keyword">from</span><span class="token operator">&gt;</span>yexy<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">from</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>heading<span class="token operator">&gt;</span>打招呼<span class="token operator">&lt;</span><span class="token operator">/</span>heading<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>content<span class="token operator">&gt;</span>哈哈哈哈<span class="token operator">&lt;</span><span class="token operator">/</span>content<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>node<span class="token operator">&gt;</span>

<span class="token comment">// JSON格式文本</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;node&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;Linzhihui&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;yexy&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;heading&quot;</span><span class="token operator">:</span><span class="token string">&quot;打招呼&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;content&quot;</span><span class="token operator">:</span><span class="token string">&quot;哈哈哈哈&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>使用 JSON 语法传输数据</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>
  <span class="token string">'{&quot;node&quot;:{&quot;to&quot;:&quot;Linzhihui&quot;,&quot;from&quot;:&quot;yexy&quot;,&quot;heading&quot;:&quot;打招呼&quot;,&quot;content&quot;:&quot;哈哈哈哈&quot;}}'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 注意，响应返回的是字符串，不是对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="json-相关-api"><a href="#json-相关-api" class="header-anchor">#</a> JSON 相关 API</h3> <h4 id="处理服务器响应的-json-字符串"><a href="#处理服务器响应的-json-字符串" class="header-anchor">#</a> 处理服务器响应的 json 字符串</h4> <p>把符合 JSON 语法的字符串转换成 JS 对象 <code>window.JSON.parse( )</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> resText <span class="token operator">=</span> request<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
<span class="token keyword">const</span> resObj <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>resText<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>一般不会直接用，避免后端传送过来的 JSON 数据有错，浏览器报错强制暂停。
处理方法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  obj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;errors'a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当被解析的&quot;errors'a&quot;是错误的JSON格式时</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj <span class="token operator">=</span> <span class="token punctuation">{</span> errors<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 手动将obj.errors替换成错误码</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>在后端设置响应头<code>response.setHeader(&quot;Content-Type&quot;,&quot;application/json&quot;),charset=utf-8</code></li> <li>jQuery 有内置 API 可以通过<code>const resText = request.responseJSON</code>，直接将 json 翻译成对象</li></ul> <h4 id="js-对象-与-json-字符串-相互转化"><a href="#js-对象-与-json-字符串-相互转化" class="header-anchor">#</a> JS 对象 与 JSON 字符串 相互转化</h4> <h5 id="json-字符串-js-对象"><a href="#json-字符串-js-对象" class="header-anchor">#</a> JSON 字符串——&gt;JS 对象</h5> <ol><li>使用 jQuery，在 ajax 函数中参数<code>Datatype</code>传 json 即可，返回的 data 即为 JSON 对象</li></ol> <ul><li>对表单处理为 json 字符串，可以使用<code>.serialize()</code>与<code>.serializeArray()</code>处理</li> <li>要作为 URL 调用，则可以使用<code>jQuery.param()</code>处理</li></ul> <ol start="2"><li><code>$.parseJSON( jsonstr)</code></li> <li>浏览器自带 <code>JSON.parse(jsonstr)</code>(推荐)</li> <li>使用字符串转代码功能 <code>eval('(' + jsonstr + ')');</code>(不推荐)</li> <li>使用 json 官方的 json.js 调用<code>parse()</code>方法</li></ol> <h5 id="js-对象-json-字符串"><a href="#js-对象-json-字符串" class="header-anchor">#</a> JS 对象——&gt;JSON 字符串</h5> <ol><li><code>JSON.stringify(jsonobj)</code>(推荐)</li> <li><code>obj.toJSONString()</code></li></ol> <h2 id="_4-跨域问题"><a href="#_4-跨域问题" class="header-anchor">#</a> 4.跨域问题</h2> <h3 id="ajax-不能跨域请求"><a href="#ajax-不能跨域请求" class="header-anchor">#</a> AJAX 不能跨域请求</h3> <p>为什么 form 表单提交没有跨域问题，但是 AJAX 提交有跨域问题?</p> <p><a href="https://www.zhihu.com/question/31592553/answer/190789780" target="_blank" rel="noopener noreferrer">知乎答案——方应杭<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>因为原页面用 form 提交到另一个域名之后，原页面的脚本无法获取新页面中的内容。所以浏览器认为这是安全的。
而 AJAX 是可以读取响应内容的，因此浏览器不能允许你这样做。其实请求已经发送出去了，你只是拿不到响应而已。
浏览器这个策略的本质是，一个域名的 JS ，在未经允许的情况下，不得读取另一个域名的内容。
但浏览器并不阻止你向另一个域名发送请求。</p></blockquote> <ul><li>也就是说：如果你不是 baidu.com 的 JS 就不能向 baidu.com 发起 AJAX 请求。</li> <li>只有协议、域名、端口 一模一样才可以发起 AJAX 请求。</li></ul> <h3 id="同源策略"><a href="#同源策略" class="header-anchor">#</a> 同源策略</h3> <p><a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener noreferrer">浏览器同源政策及其规避方法 —— 阮一峰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li>所谓&quot;同源&quot;指的是&quot;三个相同&quot;：
<blockquote><p>协议相同
域名相同
端口相同</p></blockquote></li> <li>如果非同源，共有三种行为受到限制：
<blockquote><p>Cookie、LocalStorage 和 IndexDB 无法读取。
DOM 无法获得。
AJAX 请求不能发送。</p></blockquote></li></ol> <h3 id="让-ajax-可以跨域请求"><a href="#让-ajax-可以跨域请求" class="header-anchor">#</a> 让 AJAX 可以跨域请求</h3> <ul><li>与目标请求域名的后端沟通，开放来自<code>http://yexy.com:8001</code>AJAX 请求的权限。</li> <li><code>response.setHeader ('Access-Control-Allow-Origin' , 'http://yexy.com:8001')</code></li> <li>这项技术叫 CORS 跨源资源共享</li> <li>全称：cross-origin sharing standard</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener noreferrer">跨源资源共享（CORS）——MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="ajax-与-jsonp-比较"><a href="#ajax-与-jsonp-比较" class="header-anchor">#</a> AJAX 与 JSONP 比较</h3> <table><thead><tr><th style="text-align:center;">AJAX</th> <th style="text-align:center;">JSONP</th></tr></thead> <tbody><tr><td style="text-align:center;">可以发送任意请求</td> <td style="text-align:center;">只能 GET，不能 POST</td></tr> <tr><td style="text-align:center;">不能跨域请求，需与 CORS 技术配合</td> <td style="text-align:center;">可以跨域请求</td></tr></tbody></table> <h2 id="_5-promise"><a href="#_5-promise" class="header-anchor">#</a> 5.Promise</h2> <ul><li>Promise 只是一种确定函数形式的规范</li> <li>面对不同的服务器后端，</li> <li>对于请求成功和失败的响应的函数命名不一样</li> <li>成功可能是 success/onload 等</li> <li>失败可能是 fail/error 等</li></ul> <h3 id="jquery-的-promise"><a href="#jquery-的-promise" class="header-anchor">#</a> jQuery 的 Promise</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> <span class="token string">&quot;/xxx&quot;</span><span class="token punctuation">,</span>
  method<span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
  key<span class="token operator">:</span> value<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> fail<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li>成功函数和失败函数可以不具名：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>这是 jQuery 的 promise</li> <li>可以多个.then()链式操作下去，实现对同一个状态进行多次处理</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">1111</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 成功函数，接收.ajax()的返回值</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">2222</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment">// 失败函数，接收.ajax()的返回值</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter"><span class="token number">1111</span> <span class="token operator">/</span> <span class="token number">2222</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 成功函数，接收上一个.then()成功/失败函数的返回值(无论成功还是失败了，只要上一个.then成功执行了就是成功)</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 失败函数，上一个.then()失败了执行</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="自己封装实现-promise"><a href="#自己封装实现-promise" class="header-anchor">#</a> 自己封装实现 Promise</h3> <ul><li>jQuery 的.ajax()是有返回值的</li> <li>我们自己写得 ajax 没有返回值，因此要手动设置返回值</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>window.jQuery.ajax = function (arr) {return new Promise(function (resolve, reject) {})}
const promise = window.jQuery.ajax()
promise.then(fn1,fn2)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span>jQuery<span class="token punctuation">.</span><span class="token function-variable function">ajax</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> body <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> headers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      request<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> headers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    request<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">299</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>$ <span class="token operator">=</span> window<span class="token punctuation">.</span>jQuery<span class="token punctuation">;</span>

yexy<span class="token punctuation">.</span>button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/yyyexy&quot;</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    body<span class="token operator">:</span> <span class="token string">&quot;a=1&amp;b=2&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求成功了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getAllResponseHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求失败了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><hr> <p><em>Copyright © 2020 - 2021 by 叶旭瑶 . All Rights Reserved .</em></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[02]输入URL到页面展示.html" class="prev">
        [02]输入URL到页面展示
      </a></span> <span class="next"><a href="/我的学习笔记/04-蒂姆·伯纳斯·李Browser/[04]请求响应头与JSONP前后端分离.html">
        [04]请求响应头与JSONP前后端分离
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a8df1c95.js" defer></script><script src="/assets/js/2.48d09664.js" defer></script><script src="/assets/js/37.fe07ec53.js" defer></script>
  </body>
</html>
